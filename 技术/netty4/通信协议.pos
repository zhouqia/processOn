{"diagram":{"image":{"height":200,"pngdata":"iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAYAAACtWK6eAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAsUlEQVR4nO3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8GXHmAAFMgHIEAAAAAElFTkSuQmCC","width":200,"y":0,"x":0},"elements":{"id":"root","structure":"mind_free","leftChildren":[],"title":"通信协议<br>","root":true,"theme":"theme3","children":[{"id":"65310c9b753f","title":"a.通信协议是什么","parent":"root","children":[{"id":"c3c3407739c1","title":"发送方将数据转为二进制流发送给接收方，接收方将二进制流解析为可识别对象的协议<br>","children":[],"parent":"65310c9b753f"}]},{"id":"29ec1bda31dc","title":"b.拆包/粘包","summaries":[{"id":"5a7d369528e5","summary":true,"title":"MTU = MSS + IP首部(20byte) + TCP首部(20byte)<br>","style":{"lineType":"curve_complex","lineColor":"#63abf7","lineWidth":"1"},"range":"0,1","children":[{"id":"c28446035090","title":"如果一次传输报文长度超长，则会被拆分为多次发送","children":[],"parent":"5a7d369528e5"}],"parent":"29ec1bda31dc"},{"summary":true,"id":"d9874cb3a4f4","title":"导致需要拆包/粘包","range":"3,3","style":{"lineType":"curve_complex","lineColor":"#63abf7","lineWidth":"1"},"parent":"29ec1bda31dc","children":[]}],"parent":"root","children":[{"id":"1cb131b9f713","title":"1.MTU(链路层一次最大传输数据长度， 1500byte)<br>","parent":"29ec1bda31dc","children":[]},{"id":"6ebe580229f4","title":"2.MSS(链路层一次最大传输报文长度)<br>","children":[],"parent":"29ec1bda31dc"},{"id":"c9a7e2f234b8","title":"3.滑动窗口(通道窗口)<br>","children":[{"id":"7edd457d2351","title":"用于控制每次发送数据大小 - 控制流量<br>","parent":"c9a7e2f234b8","children":[]}],"parent":"29ec1bda31dc"},{"id":"0998f65d065f","title":"4.nagle算法 - 批量发送<br>","children":[{"id":"c1edfdaff0d6","title":"用来解决频繁发送小数据包，造成网络拥堵的问题<br>","children":[],"parent":"0998f65d065f"},{"id":"36d41c2db3a0","title":"linux默认使用nagle算法 -&nbsp;降低网络开销","children":[],"parent":"0998f65d065f"},{"id":"8059a4a6d480","title":"netty默认关闭nagle算法 -&nbsp;使数据传输延迟最小化","children":[],"parent":"0998f65d065f"}],"parent":"29ec1bda31dc","collapsed":false},{"id":"247854a410da","title":"5.拆包/粘包的方法 - 通信协议","children":[{"id":"615e9360b363","title":"消息长度固定","parent":"247854a410da","children":[{"id":"d7b9a4f69349","title":"无法选择合适的长度","parent":"615e9360b363","children":[{"id":"6450041548ae","title":"一般情况下，不被采用<br>","parent":"d7b9a4f69349","children":[]}]}]},{"id":"466c72c5b292","title":"特定分隔符<br>","parent":"247854a410da","children":[{"id":"862f98e9b3b2","title":"redis以换行为分隔符","children":[],"parent":"466c72c5b292"}]},{"id":"8d9dec381d1f","title":"消息长度 + 消息内容<br>","children":[{"id":"c0b5845020fe","title":"最常用的一种协议","children":[{"id":"8843f129392a","title":"dubbo","children":[],"parent":"c0b5845020fe"},{"id":"ad62bb41c4c6","title":"rocketmq<br>","children":[],"parent":"c0b5845020fe"}],"parent":"8d9dec381d1f"}],"parent":"247854a410da"}],"parent":"29ec1bda31dc"},{"id":"348d49652692","title":"6.获取完成的拆包/粘包对应的数据","children":[{"id":"308b98d5b648","title":"","children":[],"parent":"348d49652692","image":{"w":317,"url":"http://cdn.processon.com/5faa52755653bb2563546616?e=1605001350&amp;token=trhI0BY8QfVrIGn9nENop6JAc6l5nZuxhjQ62UfM:_5QfW27lluL5C5fQyehT1csFRns=","h":143}}],"parent":"29ec1bda31dc"}],"collapsed":true},{"id":"3c8c8ccd9741","title":"c.基于通信协议解析数据 -&nbsp;处理拆包/粘包","children":[{"id":"f206751d9362","title":"1.如何判断 ByteBuf 是否存在完整的报文？ -&nbsp;最常用的做法就是通过读取消息长度 dataLength 进行判断","children":[],"parent":"3c8c8ccd9741"},{"id":"82d45fdf7415","title":"案例","parent":"3c8c8ccd9741","children":[{"id":"b5631bb17972","title":"","image":{"w":410,"url":"http://cdn.processon.com/5faa53cdf346fb6867a078c9?e=1605001693&amp;token=trhI0BY8QfVrIGn9nENop6JAc6l5nZuxhjQ62UfM:rN2MuChxlfozWupCCF4JR2sCOoY=","h":454},"children":[],"parent":"82d45fdf7415"}]}],"parent":"root","collapsed":true}]}},"meta":{"id":"5faa31a5e0b34d7a1aa2138c","member":"5b8deb14e4b06fc64ae2c0eb","exportTime":"2020-11-18 16:36:16","diagramInfo":{"category":"mind_free","title":"通信协议","created":"2020-11-10 14:22:29","creator":"5b8deb14e4b06fc64ae2c0eb","modified":"2020-11-10 16:49:17"},"type":"ProcessOn Schema File","version":"1.0"}}