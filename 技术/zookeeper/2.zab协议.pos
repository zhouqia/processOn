{"diagram":{"image":{"height":200,"pngdata":"iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAYAAACtWK6eAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAsUlEQVR4nO3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8GXHmAAFMgHIEAAAAAElFTkSuQmCC","width":200,"y":0,"x":0},"elements":{"id":"root","structure":"mind_free","leftChildren":[],"title":"zab协议","root":true,"theme":"theme3","children":[{"id":"93bee2bab52e","title":"什么是zab协议","children":[{"id":"3d99af7ab237","title":"概念","children":[{"id":"9ca181475543","title":"Zab协议 的全称是 Zookeeper Atomic Broadcast （Zookeeper原子广播）","children":[],"parent":"3d99af7ab237"},{"id":"e710c3de90f3","title":"支持崩溃恢复 的&nbsp;原子广播协议，是Zookeeper保证数据一致性的核心算法","children":[],"parent":"3d99af7ab237"},{"id":"0b4336963935","title":"leader通过选举产生","parent":"3d99af7ab237","children":[]},{"id":"db3c2ce34162","title":"leader维护所有follower的列表","parent":"3d99af7ab237","children":[]},{"id":"5e719a94fa13","title":"follower告知leader自身当前最新的事务id，leader负责同步本身数据给follower<br>","children":[],"parent":"3d99af7ab237"},{"id":"129f542598ea","title":"leader负责处理事务性请求，并广播给所有follower","parent":"3d99af7ab237","children":[]}],"parent":"93bee2bab52e"},{"id":"1ffeae19d5ae","title":"特性","children":[{"id":"15d6f0bd0622","title":"确保在leader上提交的事务被所有的服务节点提交<br>","parent":"1ffeae19d5ae","children":[]},{"id":"70f7826d3682","title":"确保在ledare上被丢弃的事务被所有的服务节点丢弃<br>","children":[],"parent":"1ffeae19d5ae"}],"parent":"93bee2bab52e"},{"id":"409921d28ef1","title":"作用","children":[{"id":"855c961b9b2b","title":"确保所有事务性请求被leader处理，并通过zab协议(原子广播协议)通知到所有follower<br>","parent":"409921d28ef1","children":[]},{"id":"f88b56be7b60","title":"崩溃恢复 - 当主节点异常时，集群仍可正常工作","parent":"409921d28ef1","children":[]}],"parent":"93bee2bab52e"},{"id":"55b625ded6cc","title":"核心","children":[{"id":"762a253c9a58","title":"定义事务性请求的处理方式","children":[],"parent":"55b625ded6cc"}],"parent":"93bee2bab52e"},{"id":"e13e3da62cf7","title":"模式","children":[{"id":"85dcd28e5ce4","title":"崩溃恢复","summaries":[{"id":"a609213d72be","summary":true,"title":"解决2PC单点故障的问题","style":{"lineType":"curve_complex","lineColor":"#bf1e1b","lineWidth":"1"},"range":"0,1","children":[],"parent":"85dcd28e5ce4"}],"children":[{"id":"c92111289946","title":"选举产生新leader","children":[],"parent":"85dcd28e5ce4"},{"id":"d8da924b09ab","title":"数据恢复","parent":"85dcd28e5ce4","children":[{"id":"6a7d6efdcdf1","title":"follower告知leader自身当前最新的事务id","children":[],"parent":"d8da924b09ab"},{"id":"4ae638409ff4","title":"leader根据follower提供的事务id决定恢复策略","children":[],"parent":"d8da924b09ab"}]}],"parent":"e13e3da62cf7"},{"id":"61ab7bd8e9b3","title":"广播消息<br>","children":[{"id":"abf98f28de08","title":"事务性请求","children":[],"parent":"61ab7bd8e9b3"},{"id":"f311789957b6","title":"步骤","children":[{"id":"24cc25da9d80","title":"客户端发起一个写操作请求","children":[],"parent":"f311789957b6"},{"id":"d494307f0e96","title":"Leader 服务器将客户端的请求转化为事务 Proposal 提案，同时为每个 Proposal 分配一个全局的ID，即zxid<br>","children":[],"parent":"f311789957b6"},{"id":"c9377084bc74","title":"Leader 服务器为每个 Follower 服务器分配一个单独的队列，然后将需要广播的 Proposal 依次放到队列中取，并且根据 FIFO 策略进行消息发送","parent":"f311789957b6","children":[]},{"id":"55221cfeeff3","title":"Follower 接收到 Proposal 后，会首先将其以事务日志的方式写入本地磁盘中，写入成功后向 Leader 反馈一个 Ack 响应消息","parent":"f311789957b6","children":[]},{"id":"2052bcaa8457","title":"Leader 接收到超过半数以上 Follower 的 Ack 响应消息后，即认为消息发送成功，可以发送 commit 消息","parent":"f311789957b6","children":[]},{"id":"7cfeabcc6ead","title":"Leader 向所有 Follower 广播 commit 消息，同时自身也会完成事务提交。Follower 接收到 commit 消息后，会将上一条事务提交","parent":"f311789957b6","children":[]}],"parent":"61ab7bd8e9b3"}],"parent":"e13e3da62cf7"}],"parent":"93bee2bab52e"}],"parent":"root"}]}},"meta":{"id":"5fb399f6f346fb5f0e1f1ff3","member":"5b8deb14e4b06fc64ae2c0eb","exportTime":"2020-11-18 16:34:32","diagramInfo":{"category":"mind_free","title":"2.zab协议","created":"2020-11-17 17:37:58","creator":"5b8deb14e4b06fc64ae2c0eb","modified":"2020-11-17 20:31:00"},"type":"ProcessOn Schema File","version":"1.0"}}